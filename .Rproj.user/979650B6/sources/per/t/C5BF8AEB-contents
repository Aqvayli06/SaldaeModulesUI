#' reporting_board_module UI Function
#'
#' @description A shiny Module.
#' @author Farid Azouaou
#' @param id,input,output,session Internal parameters for {shiny}.
#' @export
SA_reporting_UI <- function(id){
  ns <- NS(id)
  fluidPage(
    fluidRow(
      column(width = 12,
             uiOutput(ns("report_header_box"))
      )
    ),
    fluidRow(
      column(width = 12,
             uiOutput(ns("report_body_box"))
      )
    ),
    #------------------- Generate Report
    uiOutput(ns("generate_report"))
  )

}



#' reporting_board_module Server Function
#'
#' @description A shiny Module.
#' @author Farid Azouaou
#' @param id,input,output,session Internal parameters for {shiny}.
#' @export

SA_reporting_mod <- function(input, output, session,tisefka_list){


  output$report_header_box <- renderUI({
    shinydashboard::box(title = "Reporting Document Information",collapsible = TRUE,
                        status = "success",width = 12,
                        #-----HEADER CONTENT
                        fluidRow(
                          column(width = 3,
                                 uiOutput(session$ns("report_title"))),
                          column(width = 3,
                                 uiOutput(session$ns("report_author"))),
                          column(width = 3,
                                 uiOutput(session$ns("report_time"))),
                          column(width = 3,
                                 uiOutput(session$ns("report_type")))
                        )
                    )
  })


  output$report_title <- renderUI({
    textInput(session$ns("report_title"), label = "Document Title:", value = "Saldae Analytics Daily report")
  })
  output$report_author <- renderUI({
    textInput(session$ns("report_author"), label = "Author:", value = "Faridh")
  })

  output$report_time <- renderUI({
    textInput(session$ns("report_time"), label = "Creation Time:", value = format(Sys.time(),"%Y-%m-%d %H:%M"))
  })

  output$report_type <- renderUI({
    selectInput(session$ns("report_type"), label = "Document Type:", choices = c("html","pdf","dashboard","powerpoint"))
  })


output$generate_report <- renderUI({
  tisefka_list()
  shinyWidgets::actionBttn(inputId = session$ns("generate_report"),
                           label = "Generate Report")
})

output$report_body_box <- renderUI({
  shinydashboard::box(title = "Reporting Document Content",collapsible = TRUE,
                      status = "success",width = 12,
                      #-----HEADER CONTENT
                      fluidRow(
                        column(width = 12,
                               textAreaInput(inputId =session$ns("report_asezwer"), label = "Introduction/Summary",
                                             value = "", width = "800px",height = "150px"))
                      )
  )
})

saldae_report_header <- reactive({
   header_list <- list(
    title   = input$report_title,
    author  = input$report_author,
    date    = input$report_time,
    output  = list(paste0(input$report_type,"_document")),
    params = list(
      "sald_explor_chart" = "NA",
      "sald_predict_chart" = "NA",
      "sald_introduction" = "NA",
      "sald_report_asezwer"   = "NA"
    )
   )
})



observeEvent(input$generate_report,{
  req(tisefka_list())
  rmd_files  <- c("Saldae_base_chunk_dashboard.Rmd","Saldae_base_chunk_html.Rmd","Saldae_variable_explorer_block.Rmd","Saldae_reporting_menu.Rmd")
  rmd_files_package  <- system.file(rmd_files, package = "SaldaeReporting")
  dir.create("./reporting")
  file.copy(from = rmd_files_package,to = paste0("./reporting/",rmd_files),overwrite = TRUE)
  SaldaeReporting::SALDAE_reporting_engine(dash_aqerruy = saldae_report_header(),dash_asezwer = input$report_asezwer,dash_ul = tisefka_list())
})

}
