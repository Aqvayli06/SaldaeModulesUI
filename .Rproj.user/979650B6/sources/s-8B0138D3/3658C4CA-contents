#' The application User-Interface
#'
#' @param request Internal parameter for `{shiny}`.
#'     DO NOT REMOVE.
#' @import shiny
#' @noRd
app_ui <- function(request) {
  tagList(
    dashboardthemes::shinyDashboardThemes(
      theme = "SA_theme.css"
    ),
    shinydashboard::dashboardPage(
      # Leave this function for adding external resources
      header = generate_dashboard_header(),
      sidebar = shinydashboard::dashboardSidebar(
        collapsed = TRUE, shinydashboard::sidebarMenuOutput("sidebar")
      ),
      body = shinydashboard::dashboardBody(
        # includeCSS("https://bootswatch.com/4/superhero/bootstrap.css"),
        # Leave this function for adding external resources
        shinyjs::useShinyjs(),
        golem_add_external_resources(),

        shiny::tags$head(
          shiny::tags$style(".table{margin: 0 auto;}"),
          shiny::tags$script(
            src = "https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/3.5.16/iframeResizer.contentWindow.min.js",
            type = "text/javascript"
          ),
          shiny::tags$head(shiny::tags$script(src = "www/returnClick.js"))
        ),
        shinyauthr::loginUI("login"),
        shiny::tags$head(shiny::tags$style(shiny::HTML(".content-wrapper {
                                                       background-color: #E0E0E0;
}
.well{background-color:#2E8B57
"))),
        shinydashboard::tabItems(
          ####################################### RENEWABLES########################
          shinydashboard::tabItem(
            tabName = "Renewables",
            shiny::tabsetPanel(
              type = "pills", id = "renewables_id",
              # .     Panel:
              shiny::tabPanel("Imbalance Price",
                icon = shiny::icon("balance-scale"),
                # Copy the line below to make a date selector
                shiny::dateInput("date_reBap", label = NULL, value = Sys.Date()),
                shiny::mainPanel(
                  width = 12,
                  fluidPage(
                    fluidRow( # Dsiplay summary
                      column(
                        width = 8,
                        shinycssloaders::withSpinner(ui_element = dygraphs::dygraphOutput("plot_reBAP"), color = spinner_color)
                      ),
                      # . plot correation matrix
                      column(
                        width = 4,
                        DT::dataTableOutput("reBAP_tukc")
                      )


                      # ..........tfuk fluid row(market data)
                      ,
                      DT::dataTableOutput("epexspot_data")
                    )
                  )
                )
              )
            )
            #        tabPanel("Market Data",icon = shiny::icon("chart-line"),
            #                 fluidRow(
            #                      shinycssloaders::withSpinner(color=spinner_color,ui_element = plotly::plotlyOutput("expex_ID_price_plot")),
            #                      plotOutput("expex_ID_volume_plot")%>%shinycssloaders::withSpinner(color=spinner_color)
            #                 )
            # ### the rest of your code
            #          ),
            #   tabPanel("Day Ahead Forecast",icon = shiny::icon("chart-line"),
            #            fluidRow(
            #              column(width = 8,
            #              plotly::plotlyOutput("expex_DA_price_forecast_plot")%>%shinycssloaders::withSpinner(color = spinner_color)
            #              ),
            #              column(width = 4,
            #              dataTableOutput("expex_DA_price_forecast_data")
            #              )
            #            )
            # ) )
          ),
          shinydashboard::tabItem(
            tabName = "Macroeconomics",
            tabsetPanel(
              type = "pills", id = "macrodata_id",
              # .     Pnael :

              tabPanel("Macro data",
                icon = shiny::icon("balance-scale"),
                sidebarPanel(
                  width = 3,
                  # . slect country
                  selectInput(
                    "Macro_indicator", "Select Macroeconomic Indicator:",
                    c(
                      "Dollar/Euro exchange rate" = "dollar_euro_exchange",
                      "Germany Exports" = "Export_Germany",
                      "Germany Consumer Price Index" = "CPI_Germany",
                      "UK Consumer Price Index" = "CPI_UnitedKingdom",
                      "Germany Unemployment rate" = "unemployment_Germany"
                    )
                  )
                ),
                mainPanel(
                  shinycssloaders::withSpinner(color = spinner_color, ui_element = dygraphs::dygraphOutput("plot_macro_data"))
                )
              )
            )
          ),
          shinydashboard::tabItem(
            tabName = "POSEIDON",
            tabsetPanel(
              type = "pills", id = "poseidon_board",


              # .     panel  : data overview
              tabPanel("OVERVIEW",
                icon = shiny::icon("table"),
                #---------------- Data source
                fluidRow(
                  column(
                    width = 3,
                    uiOutput("tisefka_tala")
                  ),
                  column(
                    width = 3,
                    # Input: Select a file ----
                    fileInput("file1", "Choose CSV File",
                      multiple = FALSE,
                      accept = c("csv")
                    )
                  ),
                  column(
                    3,
                    uiOutput("excel_tawriqt")
                  )
                ),
                shinyWidgets::downloadBttn(
                  outputId = "data_template", label = "Data Template", style = "stretch",
                  color = "primary", size = "md", block = FALSE, no_outline = FALSE
                ),
                # download button: download output data ---
                #------------------- date variable 

                fluidRow(
                  column(
                    width = 3,
                    uiOutput("date_variable")
                  ),
                  column(
                    width = 3,
                    uiOutput("SA_date_format")
                  ),
                  column(
                    width = 3,
                    uiOutput("duplicated_Date")
                  )
                ),
                uiOutput("date_variable_help"),
                #----------- tisefka spread
                fluidRow(
                  column(
                    width = 3,
                    uiOutput("tisefka_spread")
                  ),
                  column(
                    width = 3,
                    uiOutput("tisefka_spread_var")
                  )
                ),
                rhandsontable::rHandsontableOutput("explore_table_view"),
                DT::dataTableOutput("data_diagnosis")
              ),
              # .     panel  : data exploration

              tabPanel("EXPLORATION",
                icon = shiny::icon("list-alt"),
                sidebarLayout(
                  sidebarPanel = NULL,
                  mainPanel = mainPanel(
                    width = 12,
                    fluidRow(
                      column(
                        width = 4,
                        uiOutput("target_ts_exploration")
                      ),
                      column(
                        width = 4,
                        uiOutput("time_unit_data")
                      ),
                      column(
                        width = 4,
                        uiOutput("aggregation_metric")
                      )
                    ),
                    fluidRow(
                      column(
                        width = 4,
                        uiOutput("group")
                      ),
                      column(
                        width = 4,
                        uiOutput("group_by")
                      )
                    ),
                    fluidRow(
                      column(
                        width = 8,

                        uiOutput("view_explorationbox")
                      ),
                      column(
                        width = 4,
                        uiOutput("data_explorationbox")
                      )
                    ),
                    uiOutput("growth_rate_ih"),

                    fluidRow(
                      uiOutput("sekned_gemmubox")
                    ),
                    fluidRow(
                      column(
                        width = 6,
                        uiOutput("data_explorationstats")
                      ),
                      column(
                        width = 6,
                        uiOutput("data_exploration_piebox")
                      )
                    ),
                    uiOutput("business_holidays"),
                    uiOutput("timura"),

                    fluidRow(
                      width = 12,
                      uiOutput("business_holidays_databox")
                    )
                  )
                )
              ),

              # .     Panel :
              tabPanel("ANALYTICS",
                icon = shiny::icon("code-fork"),

                sidebarLayout(
                  # .
                  sidebarPanel = NULL,

                  mainPanel = mainPanel(
                    width = 12,
                    # . plot forecast object
                    uiOutput("plot_forecast_box"),

                    # Display summary
                    uiOutput("time_unit_input"),
                    fluidRow(
                      column(
                        width = 6,
                        uiOutput("plot_forecast_summary_mean_box")
                      ),
                      column(
                        width = 6,
                        uiOutput("plot_forecast_summary_sum_box")
                      )
                    )


                    # )
                  )
                )
              ),
              # .     panel  : data manipulation
              tabPanel("INSIGHTS",
                icon = shiny::icon("list-alt"),
                sidebarLayout(
                  sidebarPanel(
                    width = 3,
                    uiOutput("target_ts_manipulation_x"),
                    uiOutput("target_ts_manipulation_y"),
                    uiOutput("bivariate_stat_aggregation"),
                    uiOutput("time_unit_bivariate")
                  ),
                  mainPanel(
                    uiOutput("afeggag_wis_sin"),
                    shinycssloaders::withSpinner(ui_element = plotly::plotlyOutput("tisefka_tayuga")),

                    fluidRow(
                      shinydashboard::valueBoxOutput("data_metric1"),
                      shinydashboard::valueBoxOutput("data_metric2"),
                      shinydashboard::valueBoxOutput("data_metric3")
                    ),

                    shinycssloaders::withSpinner(ui_element = plotly::plotlyOutput("data_bivariate_group")),
                    plotly::plotlyOutput("tuqniwin_heat"),
                    plotly::plotlyOutput("taftilt")
                  )
                )
              ),

              # .     Panel  : customized dashboard
              tabPanel("ADVANCED",
                icon = shiny::icon("bolt"),
                sidebarLayout(
                  sidebarPanel(
                    width = 3,
                    uiOutput("kefrida")
                  ),
                  mainPanel(
                    # .
                    uiOutput("keferida_numericals"),
                    uiOutput("kefrida_aggregate"),
                    uiOutput("keferida_go"),
                    plotly::plotlyOutput("kefrida_plot")
                    # .
                  )
                )
              ),
              navbarMenu("More",
                icon = shiny::icon("cog"),

                tabPanel(
                  "About",
                  fluidRow(uiOutput("rnudmamaynut")),
                  fluidRow(
                    column(
                      6,
                      shinydashboardPlus::widgetUserBox(
                        title = "Farid AZOUAOU",
                        subtitle = "Founder & CEO",
                        type = 2,
                        width = 6,
                        # src ="IMG_0571_bearb_resized.jpg",
                        # src = "https://adminlte.io/themes/AdminLTE/dist/img/user1-128x128.jpg",
                        color = "green",
                        closable = FALSE,
                        "Senior Data Scientist with a solid expertise in AI and Advanced Analytics",
                        footer = ""
                      ),
                      shinydashboardPlus::widgetUserBox(
                        title = "Assirem LOUALIA",
                        subtitle = "Founder & CTO",
                        type = 2,
                        width = 6,
                        src = paste0(getwd(), "/Photo_Assirem_CV.JPG"),
                        # src = "https://adminlte.io/themes/AdminLTE/dist/img/user1-128x128.jpg",
                        color = "green",
                        closable = FALSE,
                        "Senior IT engineer with a long experience in IT consulting",
                        footer = ""
                      )
                    )
                  )
                )
              )
            )
          )
        )
      )
    )
  )
}





#' Add external Resources to the Application
#'
#' This function is internally used to add external
#' resources inside the Shiny application.
#'
#' @import shiny
#' @importFrom golem add_resource_path activate_js favicon bundle_resources
#' @noRd
golem_add_external_resources <- function() {
  golem::add_resource_path(
    "www", app_sys("app/www")
  )

  shiny::tags$head(
    golem::favicon(),
    golem::bundle_resources(
      path = app_sys("app/www"),
      app_title = "SaldaeAnalyticsProd"
    )
    # Add here other external resources
    # for example, you can add shinyalert::useShinyalert()
  )
}
